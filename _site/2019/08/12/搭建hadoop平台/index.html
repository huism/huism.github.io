<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- <title>搭建Hadoop生态环境 - huism's  Blog</title> -->
	<title>搭建Hadoop生态环境 -  Person Blog</title>

	<link rel="shortcut icon" href="/styles/images/favicon1.png">
	<link rel="icon" href="/styles/images/favicon1.png">

	<link rel="stylesheet" href="/styles/css/index.css">
	<link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="/styles/css/syntax.css">
	<link rel="canonical" href="/2019/08/12/%E6%90%AD%E5%BB%BAhadoop%E5%B9%B3%E5%8F%B0/">
	<link rel="alternate" type="application/rss+xml" title="huism's  Blog" href="/feed.xml">
	
	<meta name="keywords" content="搭建Hadoop生态环境, huism's  Blog, 个人博客;学而不思则罔;思而不学则殆;生命不止;折腾不休">
	<meta name="description" content="个人博客;学而不思则罔;思而不学则殆;生命不止;折腾不休">

	<script src="/styles/js/jquery.min.js"></script>
	<!--[if lt IE 9]>
    	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  	<![endif]-->
  	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
  	<style type="text/css">
	  	.docs-content{
	  		margin-bottom: 10px;
	  	}
  	</style>
</head>

  <body class="index">

    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <img src="/styles/images/logo1.png">
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">    
        <li>
          <a href="/">Home</a>
        </li>
        <li>
          <a href="/categories/">归档</a>
        </li>
        <li>
          <a href="/tag">标签</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <!-- <li>
            <a><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></a>
        </li> -->
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">关于<b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a rel="nofollow" target="_blank" href="https://github.com/huism/">Github</a></li>
            <li><a rel="nofollow" target="_blank" href="https://github.com/huism">关于作者</a></li>
            <li><a rel="nofollow" href="/books">我的书单</a></li>
            <!-- <li><a rel="nofollow" href="http://www.hifreud.com/domains/">域名管理</a></li> -->
            <li><a rel="nofollow" href="/reference">推荐博客</a></li>
            <!-- <li><a href="/feed.xml">RSS订阅</a></li> -->
            <li class="divider"></li>
            <li><a rel="nofollow" target="_blank" href="https://github.com/huism/huism.github.io.git">本项目</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header>
    <div class="docs-header" id="content">
  <div class="container">
  	
  		<!--
		    <h1>搭建Hadoop生态环境</h1>
		    <p>Post on Aug 12, 2019 by <a href="/about">huism</a></p>
		-->
		    <h1>It's our wits that make us men.</h1>
    
  </div>
</div>
    
      
<div class="banner">
  <div class="container">
  	
    	<a href="/categories/#document-ref">document</a>	/
    	<a href="/tag/#大数据-ref">大数据</a>
    
  </div>
</div>

    

    <div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
  </ul>
  <!-- <div style="height: 200px;width: 200px;">
    <script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33" async="async"> 
    </script>
  </div> -->
</div>

 
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">搭建Hadoop生态环境</h1>
              <!--
                <p class="post-meta">Aug 12, 2019</p>
              -->
              <div class="meta">Posted on <span class="postdate">Aug 12, 2019</span> By <a target="_blank" href="http://localhost:4000">huism</a></div>
              <br />
            </header>
            <article class="post-content">
              <?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.1.1 (458384)"/><meta name="author" content="smh201411@163.com"/><meta name="created" content="2019-04-17 03:03:33 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="yinxiang.win32"/><meta name="updated" content="2019-08-13 07:48:50 +0000"/><title>搭建hadoop平台</title></head><body><div><div><b><font style="font-size: 24px;">Hadoop大数据生态圈环境搭建</font></b></div><div><span style="font-size: 18px;"><b><br/></b></span></div><div><span style="font-size: 18px;"><b><br/></b></span></div><ol><li><div><span style="font-size: 18px; font-weight: bold;">Apache 大数据平台</span></div></li></ol><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"/><col style="width: 130px;"/><col style="width: 130px;"/><col style="width: 130px;"/><col style="width: 130px;"/></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Node1</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Node2</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Node3</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Node4</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Jdk</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Zookeeper</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Hadoop</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️主</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️主</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Scala</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Kafka</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Mysql</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Hbase</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️主</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>Spark</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️主</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div>✔️</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><div><br/></div></td></tr></tbody></table><div><br/></div><ol start="2"><li><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">安装VirtualBox虚拟机软件</span></font></div></li></ol><div>        1）下载VirtualBox软件<a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a>，之后安装即可（傻瓜式安装）。</div><div>        2）配置网卡</div><ul><ul><li><div>增加仅主机(Host-Only)网络，配置IP地址和IPv4网络掩码，并设置不启动DHCP服务器。</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>IPv4地址：192.168.56.1</div><div>IPv4网络掩码：255.255.255.0</div></div><ul><ul><li><div>设置NAT网络（若无则创建），支持DHCP，一般有默认此项不必改变。</div></li></ul></ul><div>        3）新建虚拟机，系统选择CentOS 7，版本是CentOS-7-x86_64-Minimal-1511。</div><ul><ul><li><div>第一步：创建虚拟机。 选择Linux、Linux版本，创建动态分配的VHD虚拟硬盘，创建好虚拟机之后进入下一步，</div></li><li><div>第二步：设置创建的虚拟机。存储中光盘需要选择你IOS系统文件所在的目录文件。之后设置网络，网卡1设为NAT网络；网卡2启动，并设为仅主机(Host-Only)网络选择相应的网卡。</div></li><li><div>第三步：安装系统。首先，启动系统，之后选择语言：English；选择日期时区Data&amp;Time设置为Asia/Shanghai；选择安装硬盘位置INSTALLATION SOURCE为默认；设置INSTALLATION DESTINATION为默认（需要进入并选择Done）；设置NETWORK &amp; HOST NAME，启动两个网卡，并设置Host Name为node1（数字1为虚拟机编号，之后通过node*来通信）；最后确认后开始安装；在安装时可以设置root用户密码。</div></li></ul></ul><div>        4）重复3）步骤创建5台同样的CentOS虚拟机，可以选择复制虚拟机快速创建多台虚拟机。</div><div>            <span style="color: rgb(255, 38, 0);">注意：如果复制虚拟机，需要勾选重新分配MAC地址。复制虚拟机时，主机名也一同复制，需要修改/etc/hostname文件中的内容来修改主机名，否则会在之后（查看hdfs的datanode节点）产生影响</span></div><ol start="3"><li><div><span style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">CentOS虚拟机网络配置</span></span></div></li></ol><ul><li><div>通过命令 ip addr 可以查看所有网卡信息（l0可以忽略）。</div></li><li><div>通过命令 vi /etc/sysconfig/network-scripts/ifcfg-enp0s3 设置enp0s3网卡（主要是集群内访问）属性：</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>ONBOOT=“yes”       //设置网卡开机自启，默认为yes，本注释不用写入配置文件中</div></div><ul><li><div>通过命令 vi /etc/hosts 配置hosts文件，集群中集群需要通过此配置文件来连通。可以通过命令 ping node2 来测试是否配置连接成功。</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>10.0.2.7 node1        // 地址是通过命令 ip addr 查看的enp0s3的IP地址，node1是集群中虚拟机中名字用于记忆使用方便</div><div>10.0.2.8 node2</div><div>10.0.2.9 node3</div><div>10.0.2.10 node4</div><div>10.0.2.11 node5</div></div><ul><li><div>通过命令 vi /etc/sysconfig/network-scripts/ifcfg-enp0s8 设置enp0s8网卡（主要是外界访问）属性：</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>ONBOOT=“yes”</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">BOOTPROTO=none</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">IPADDR=192.168.56.101        //新增，IP地址</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">NETMASK=255.255.255.0        //新增，掩码</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">NETWORK=192.168.56.0         //新增，网关</span></div></div><div><span style="color: rgb(255, 38, 0);">        注意：</span>其中BOOTPROTO是设置不启动DHCP服务器；IPADDR是设置网卡IPv4地址；NETMASK是网络掩码；NETWORK是网关地址。</div><ul><li><div>重启网络服务，命令：service network restart</div></li><li><div>将集群所有虚拟机都重新配置以上两张网卡。</div></li></ul><ol start="4"><li><div><span style="font-size: 18px; font-weight: bold;">新建Hadoop用户，SSH免密登录连接</span></div></li></ol><div>        新建hadoop用户，来管理所有的hadoop生态圈内的应用程序，并且在hadoop用户下使用此Hadoop生态圈应用程序，并且设置免密连接。如果不想添加用户，可以由root用户来管理所有程序，跳过新建用户，直接进行免密连接操作。</div><div>     <span style="color: rgb(255, 38, 0);">（由此开始规定：#后面的命令是root用户执行的命令，$后面的命令是hadoop用户执行的命令）</span></div><ul><li><div>新建用户</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># groupadd hadoop         //新建用户组，组名为hadoop</div><div># useradd -s /bin/bash -g hadoop -d /home/hadoop -m hadoop        //新建用户，用户名为hadoop</div><div># passwd hadoop         //设置用户hadoop的登录密码，需要输入相同的两次</div></div><ul><li><div>免密连接</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># su hadoop</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">// 在node1上执行，可以使node1向获得其密钥的节点免密登录连接，如命令 $ ssh node2</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ ssh-keygen -t rsa         //生成密钥</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ ssh-copy-id node1         //分发密钥</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ ssh-copy-id node2         //分发密钥</span></div></div><ol start="5"><li><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">集群时间同步</span></font></div></li></ol><div>        同一集群内机器需要同步时间，避免不必要的麻烦。</div><ul><li><div>安装时间同步软件</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># yum install -y ntpdate</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># yum install -y ntp</span></div></div><ul><li><div>选择一台节点作为时间服务器（如node1），其他为客户端节点向服务器节点时间同步，配置时间服务器节点</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># vi /etc/ntp.conf</div><div>// 注释掉文件中的以下四行，即在行首添加“#”</div><div>server 0.centos.pool.ntp.org iburst </div><div>server 1.centos.pool.ntp.org iburst </div><div>server 2.centos.pool.ntp.org iburst </div><div>server 3.centos.pool.ntp.org iburst</div><div>// 文件最下面加入 </div><div>restrict default ignore </div><div>restrict 10.0.2.0 mask 255.255.255.0 nomodify notrap </div><div>server 127.127.1.0</div></div><ul><li><div>重启ntpd服务</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># service ntpd restart</span></div></div><ul><li><div>设置ntpd服务开机自启</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># chkconfig ntpd on</div></div><ul><li><div>余下的客户端节点，配置如下：</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># crontab -e       // 设定每天 00:00 向服务器同步时间，并写入日志</div><div>// 输入以下内容，保存，退出。</div><div>0 0 * * * /usr/sbin/ntpdate cluster1&gt;&gt; /root/ntpd.log</div></div><ul><li><div>手动向时间服务器节点同步时间：</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># ntpdate node1         //假设时间服务器节点为node1</div></div><ol start="6"><li><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">J</span></font><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">DK环境安装配置</span></font></div></li></ol><ul><li><div>将jdk安装包上传到虚拟机节点中，我下载的是jdk1.8.0_201版本的。jdk安装到/usr/local目录下。</div></li><li><div>将安装包解压。</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># cp ./jdk-8u201-linux-x64.tar.gz /usr/local/</div><div># cd /usr/local </div><div># tar -zxvf ./jdk-8u201-linux-x64.tar.gz</div></div><ul><li><div>配置JDK环境变量</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>export JAVA_HOME=/usr/local/jdk1.8.0_201             // Java家目录</div><div>export JRE_HOME=/usr/local/jdk1.8.0_201/jre         // jre家目录</div><div>export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH </div><div>export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin:$JAVA_HOME</div></div><ul><li><div>测试安装是否成功，使用如下命令，若不报错，出现版本信息，则安装成功。</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># java -version</div></div><div>以上是集群所有节点的基础安装环境配置</div><div><br/></div><ol start="7"><li><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">Hadoop集群部署（搭建高可用(HA)集群）</span></font></div></li></ol><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 108px;"/><col style="width: 106px;"/><col style="width: 99px;"/><col style="width: 89px;"/><col style="width: 96px;"/><col style="width: 87px;"/><col style="width: 114px;"/></colgroup><tbody><tr><td style="width: 108px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 106px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Namenode-1</div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Namenode-2</div></td><td style="width: 89px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Datanode</div></td><td style="width: 96px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Zookeeper</div></td><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;">ZKFC</div></td><td style="width: 114px; padding: 8px; border: 1px solid;"><div>JournalNode</div></td></tr><tr><td style="width: 108px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Node1</div></td><td style="width: 106px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 89px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 96px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 114px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td></tr><tr><td style="width: 108px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Node2</div></td><td style="width: 106px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 89px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 96px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 114px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td></tr><tr><td style="width: 108px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Node3</div></td><td style="width: 106px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 89px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 96px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 114px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td></tr><tr><td style="width: 108px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Node4</div></td><td style="width: 106px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 89px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 96px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 114px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td></tr><tr><td style="width: 108px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Node5</div></td><td style="width: 106px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 89px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 96px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 114px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td></tr></tbody></table><ol start="8"><li><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">Hadoop安装（HA of HDFS）</span></font></div></li></ol><ul><li><div>版本：Hadoop 3.1.1</div></li><li><div>上传hadoop-2.6.5 安装包到虚拟机节点node1中，解压到/opt目录中。</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># cp ./hadoop-2.6.5.tar.gz  /opt      // 复制安装包到/opt目录下</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># cd /opt</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># tar -zxvf hadoop-2.6.5.tar.gz       // 解压</span></div></div></div><ul><li><div>修改配置文件</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># cd /opt/hadoop-2.6.5/etc/hadoop        // 进入Hadoop配置文件所在目录，配置文件都在 etc/hadoop 目录下</div></div><ul><ul><li><div>修改 hadoop-env.sh 配置文件，在文末尾添加如下配置：</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>export JAVA_HOME=/usr/local/jdk1.8.0_201            // 指定Java安装路径，自己机器上真实路径</div><div>export HDFS_NAMENODE_USER=hadoop</div><div>export HDFS_DATANODE_USER=hadoop</div><div>export HDFS_SECONDARYNAMENODE_USER=hadoop</div></div><ul><ul><li><div>修改 core-site.xml 配置文件，添加如下：</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><font face="Monaco"> &lt;!-- 在&lt;configurations&gt;&lt;/configuration&gt;内添加    —&gt;</font></div><div>    &lt;property&gt;</div><div>        &lt;name&gt;fs.defaultFS&lt;/name&gt;               &lt;!-- 集群的逻辑名    —&gt;</div><div>        &lt;value&gt;hdfs://mycluster&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>    &lt;!-- 集群数据存放本地路径，namenode,datanode数据都会存在这里，会自动生成./ha/dfs/name 目录和 ./ha/dfs/data —-&gt;</div><div>        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; </div><div>        &lt;value&gt;/home/hadoop/hadoop_files/ha&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>        &lt;name&gt;fs.trash.interval&lt;/name&gt;</div><div>        &lt;value&gt;1440&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>        &lt;name&gt;ha.zookeeper.quorum&lt;/name&gt;        &lt;!-- zookeeper集群节点，ip:port，用“,”分割    —&gt;</div><div>        &lt;value&gt;node2:2181,node3:2181,node4:2181&lt;/value&gt;</div><div>    &lt;/property&gt;</div></div><ul><ul><li><div>修改 hdfs-site.xml 配置文件，添加如下：</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>    &lt;!—- 添加到&lt;configuration&gt;&lt;/configuration&gt;中    —-&gt;</div><div>    &lt;property&gt;</div><div>        &lt;!—- 备份个数  —-&gt;</div><div>        &lt;name&gt;dfs.replication&lt;/name&gt;</div><div>        &lt;value&gt;2&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>        &lt;!—- 集群逻辑名，同core-site.xml文件中的fs.defaultFS逻辑名保持一致  —-&gt;</div><div>        &lt;name&gt;dfs.nameservices&lt;/name&gt;</div><div>        &lt;value&gt;mycluster&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>        &lt;!—- NameNode节点逻辑名  —-&gt;</div><div>          &lt;name&gt;dfs.ha.namenodes.mycluster&lt;/name&gt;</div><div>          &lt;value&gt;nn1,nn2&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>        &lt;!—- NameNode节点逻辑名对应的节点物理地址，ip:port，指向namenode1 —-&gt;</div><div>          &lt;name&gt;dfs.namenode.rpc-address.mycluster.nn1&lt;/name&gt;</div><div>          &lt;value&gt;node1:8020&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>        &lt;!—- NameNode节点逻辑名对应的地址，ip:port，指向namenode2  —-&gt;</div><div>          &lt;name&gt;dfs.namenode.rpc-address.mycluster.nn2&lt;/name&gt;</div><div>          &lt;value&gt;node2:8020&lt;/value&gt;</div><div>    &lt;/property&gt;    </div><div>    &lt;property&gt;</div><div>        &lt;!—- NameNode节点的web ui访问地址和端口，ip:port，namenode1的web UI —-&gt;</div><div>          &lt;name&gt;dfs.namenode.http-address.mycluster.nn1&lt;/name&gt;</div><div>        &lt;!—- ip地址填真实的地址，若有两张网卡，注意区分  —-&gt;</div><div>          &lt;value&gt;192.168.56.101:50070&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>          &lt;name&gt;dfs.namenode.http-address.mycluster.nn2&lt;/name&gt;</div><div>          &lt;value&gt;192.168.56.102:50070&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>        &lt;!—- 指向journalnode节点，qjournal://ip:port,ip:port   —-&gt;</div><div>        &lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt;</div><div>        &lt;value&gt;qjournal://node1:8485;node2:8485;node3:8485/mycluster&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>        &lt;!—- namenode向journalnode同步数据存储的本地路径，自己设置  —-&gt;</div><div>      &lt;name&gt;dfs.journalnode.edits.dir&lt;/name&gt;</div><div>      &lt;value&gt;/home/hadoop/hadoop_files/ha/journal&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>        &lt;!—- 代理，只需照着设置即可  —-&gt;</div><div>      &lt;name&gt;dfs.client.failover.proxy.provider.mycluster&lt;/name&gt;</div><div>      &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>          &lt;name&gt;dfs.ha.fencing.methods&lt;/name&gt;</div><div>          &lt;value&gt;shell(/bin/true)&lt;/value&gt;</div><div>    &lt;/property&gt;</div><div>    &lt;property&gt;</div><div>       &lt;name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt;</div><div>       &lt;value&gt;true&lt;/value&gt;    </div><div>    &lt;/property&gt;</div></div><ul><ul><li><div>修改 slaves 配置文件，添加如下：</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div> // 文件中删除其他内容，添加如下内容，注意，此注释勿写进文件，配置的是datanode节点的主机名，3.x版本中是worker文件</div><div>node2</div><div>node3</div><div>node4</div></div><ul><li><div>启动Hadoop集群</div></li><ul><li><div>启动 Zookeeper 集群</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ zkServer.sh start         //在每个zookeeper集群节点上运行一次</span></div></div><ul><ul><li><div>启动 JouranlNode 进程（在node1,node2,node3上启动）</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ hadoop-daemon.sh start journalnode        //在需要的节点启动</span></div></div><ul><ul><li><div>格式化 ZKFC </div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>$ hdfs zkfc -formatZK        // 在node1上运行</div></div><ul><ul><li><div>格式化 NameNode 节点，并且启动NameNode</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div> // （只在node1节点上运行）</div><div>$ hdfs namenode –format</div><div>$ hadoop-daemon.sh start namenode</div><div> // （只在node2节点上运行）</div><div>$ hdfs namenode –bootstrapStandby</div><div>$ hadoop-deamon.sh start namenode</div><div> // （关闭所有nodenode进程，在node1和node2节点上分别运行如下命令）</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ hadoop-daemon.sh stop namenode    </span></div></div><ul><ul><li><div>启动 Hadoop</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ start-dfs.sh    // 只在node1节点上运行，并是hadoop用户，journal进程已启动，会提示先关闭，可忽略。</span></div></div><ul><ul><li><div>正常启动后，集群节点内有如下进程，可进行验证。</div></li></ul></ul><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 87px;"/><col style="width: 102px;"/><col style="width: 105px;"/><col style="width: 92px;"/><col style="width: 223px;"/><col style="width: 99px;"/></colgroup><tbody><tr><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 102px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Namenode</div></td><td style="width: 105px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Datanode</div></td><td style="width: 92px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Zookeeper</div></td><td style="width: 223px; padding: 8px; border: 1px solid;"><div style="text-align: center;">DFSZKFailoverController(zkfc)</div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Journalnode</div></td></tr><tr><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Node1</div></td><td style="width: 102px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 105px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 92px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 223px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td></tr><tr><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Node2</div></td><td style="width: 102px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 105px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 92px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 223px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td></tr><tr><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Node3</div></td><td style="width: 102px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 105px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 92px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 223px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td></tr><tr><td style="width: 87px; padding: 8px; border: 1px solid;"><div style="text-align: center;">Node4</div></td><td style="width: 102px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 105px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 92px; padding: 8px; border: 1px solid;"><div style="text-align: center;">*</div></td><td style="width: 223px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td><td style="width: 99px; padding: 8px; border: 1px solid;"><div style="text-align: center;"><br/></div></td></tr></tbody></table><ol start="9"><li><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">安装Scala</span></font></div></li></ol><ul><li><div>将Scala安装到集群所有节点上，并分配给hadoop用户使用</div></li><li><div>将安装包解压到 /opt/ 目录下（在node1上执行）</div></li></ul></div><ul><li><div>将Scala分发到其他节点上（在node1上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># scp -r /opt/scala-2.10.6 node2:/opt/            // 分发到所有节点，node2,node3,node4</div></div><ul><li><div>配置环境变量 命令：vi /etc/profile 在末尾追加如下内容（在所有节点上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>export SCALA_HOME=/opt/scala-2.10.6            # Scala的安装路径</div><div>export PATH=$PATH:$SCALA_HOME/bin</div></div><ul><li><div>刷新环境变量（在所有节点上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># source /etc/profile</div></div><ul><li><div>修改用户所有者（在所有节点上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># chown -R hadoop:hadoop /opt/scala-1.10.6        // 修改所有节点的Scala安装目录所拥有的用户</div></div><div><br/></div><ol start="10"><li><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">安装Kafka</span></font></div></li></ol><ul><li><div>规划在node1,node3,node4上安装kafka。</div></li><li><div>将kafka安装包拷贝到/opt/ 目录下，解压（以下在node1上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># cp ./kafka_2.10-0.8.2.1.tgz /opt/</div><div># tar -zxvf kafka_2.10-0.8.2.1.tgz</div><div># cd /opt/</div><div># mv kafka_2.10-0.8.2.1 kafka</div></div><ul><li><div>添加环境变量 </div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># vi /etc/profile</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">// 在文件末尾中添加如下内容</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"> e</span><font face="Monaco">xport KAFKA_HOME=/opt/kafka</font></div><div><font face="Monaco"> export PATH=$PATH:$KAFKA_HOME/bin</font></div><div><font face="Monaco"><br/></font></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">// 保存退出后，更新环境变量</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># source /etc/profile</span></div></div><ul><li><div>修改配置文件 /opt/kafka/config/server.properties </div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">// 修改内容如下</span></div><div><font face="Monaco">Broker.id=0        //指定broker的ID，<b>从0开始</b>，<b>每个节点不同</b>，node3是1，node4是2</font></div><div>log.dirs=/home/hadoop_files/kafka-logs        // 指定kafka存储日志数据的路径</div><div>zookeeper.connect=node2:2181,node3:2181,node4:2181     // 指定zookeeper集群节点</div><div>advertised.host.name=192.168.56.101        // 指定本节点(node1)的IP地址，其他kafka集群节点更改成自己的IP地址</div></div><ul><li><div>创建kafka数据存放路径（是log.dirs配置的值）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># mkdir -p /home/hadoop/hadoop_files/kafka-logs</div></div><ul><li><div>修改文件权限，更改为hadoop用户权限</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># chown -R hadoop:hadoop /opt/kafka </div><div># chown -R hadoop:hadoop /home/hadoop_files/kafka-logs</div></div><ul><li><div>分发安装好的程序到kafka集群其他节点（node3,node4），在node1上执行</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># cd /opt/</div><div># scp -r ./kafka/  node3:`pwd`        // 分发到node3节点上</div><div># scp -r ./kafka/  node4:`pwd`        // 分发到node4节点上</div></div><ul><li><div>在node3上修改 server.properties 中的broker.id （在node3上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>broker.id=1</div></div><ul><li><div>在node4上修改 server.properties 中的broker.id（在node4上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>broker.id=2</div></div><ul><li><div>新建存储日志数据的路径目录，并其修改权限和 /opt/kafka的权限为hadoop用户。（在node3和node4上分别执行）</div></li><li><div>新建启动脚本和关闭脚本，</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># cd /opt/kafka/bin</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># vi start-kafka.sh</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">// 在文件中添加如下内容（一行内容，无换号），保存</span></div><div> nohup kafka-server-start.sh /opt/kafka/config/server.properties &gt; /home/hadoop/hadoop_files/kafka-logs/kafka-start.log 2&gt;&amp;1 &amp;</div><div><br/></div><div># vi stop-kafka.sh</div><div>// 在文件中添加如下内容,一行内容，无换号，保存</div><div> kafka-server-stop.sh</div><div><br/></div><div># chmod u+x start-kafka.sh                // 添加可执行权限</div><div># chmod u+x start-kafka.sh                // 添加可执行权限</div><div># chown -R hadoop:hadoop /opt/kafka       // 修改所属用户</div></div><ul><li><div>完成安装，通过如下测试</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># su hadoop</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">// <b>保证zookeeper集群已经启动</b></span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ start-kafka.sh        // 启动kafka</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ </span>kafka-topics.sh --create --zookeeper cluster1:2181,cluster2:2181,cluster3:2181 --replication-factor 3 --partitions 1 --topic mykafka            // 创建topic</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ stop-kafka.sh         // 关闭kafka</span></div></div><div><br/></div><ol start="11"><li><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">安装MySQL</span></font></div></li></ol><ul><li><div>在集群节点node2上安装MySQL，其他节点不需要安装。（以下只在node2中执行）</div></li><li><div>预先安装 screen ，perl， perl-devel， autoconf 四个软件</div></li><li><div>将安装包上传到节点上，解压到/usr/local/ 目录下，并重命名为mysql</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># cd /usr/local/</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># tar -zxvf /usr/local/</span>mysql-5.6.37-linux-glibc2.12-x86_64.tar.gz</div><div># mv mysql-5.6.37-linux-glibc2.12-x86_64 mysql</div></div><ul><li><div>修改环境变量</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># vi /etc/profile </div><div>// 在最下面添加 </div><div> export MYSQL_HOME=/usr/local/mysql </div><div> export PATH=$PATH:$MYSQL_HOME/bin</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">// 刷新环境变量</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># source /etc/profile</span></div></div><ul><li><div>新建 mysql 用户</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># groupadd mysql 在/etc/group 中可以看到 </div><div># useradd -r -g mysql -s /bin/false mysql 在/etc/passwd 中可以看到 </div><div># cd /usr/local/mysql </div><div># chown -R mysql:mysql .</div><div># scripts/mysql_install_db --user=mysql</div></div><div>注意：若运行 scripts/mysql_install_db --user=mysql 报错，需要安装 perl , perl-devel , autoconf，再次运行，即可解决。</div><ul><li><div>修改当前目录拥有者为 root 用户</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># chown -R root .</div><div># chown -R mysql data        // 修改当前 data 目录拥有者为 mysql 用户</div></div><ul><li><div>新建一个虚拟窗口，叫 mysql，运行命令</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># screen -S mysql</div><div># bin/mysqld_safe --user=mysql &amp;</div><div>// 退出虚拟窗口 </div><div># Ctrl+A+D </div><div># cd /usr/local/mysql</div><div>// 登陆 mysql </div><div># bin/mysql</div><div>// 登陆成功后退出即可 </div><div># exit;</div></div><ul><li><div>进行 root 账户密码的修改等操作</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># bin/mysql_secure_installation</div><div><br/></div><div>首先要求输入 root 密码，由于我们没有设置过 root 密码，括号里面说了，如果没有 root 密码就直接按回车。 是否设定 root 密码，选 y，设定密码为 cluster，是否移除匿名用户：y。然后有个是否关闭 root 账户的远程 登录，选 n，删除 test 这个数据库？y，更新权限？y，然后 ok。</div><div><br/></div><div># cp support-files/mysql.server /etc/init.d/mysql.server</div><div><br/></div><div><br/></div><div>// 进入 mysql 虚拟窗口 </div><div># screen -r mysql </div><div>// 查看 mysql 的进程号 </div><div># ps -ef | grep mysql </div><div>// 如果有的话就 kill 掉，保证 mysql 已经中断运行了，一般 kill 掉/usr/local/mysql/bin/mysqld 开头的即可 </div><div># kill 进程号</div><div>// 退出虚拟窗口</div><div># Ctrl+A+D</div></div><ul><li><div><span style="font-weight: bold;">启动MySQL服务</span></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># /etc/init.d/mysql.server start -user=mysql           //（-user参数可省略）</div></div><ul><li><div>配置一下访问权限</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>$ mysql -u root -p </div><div>mysql&gt; GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'cluster' WITH GRANT OPTION;</div><div>mysql&gt; FLUSH PRIVILEGES;</div></div><ul><li><div>关闭MySQL</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>// 关闭 mysql 的指令（不需要执行） </div><div># mysqladmin -u root -p shutdown</div></div><ul><li><div>注意：每次启动节点，若执行 mysql -u root -p 报错</div></li></ul><div>                ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)</div><div>        解决：需要启动MySQL服务，执行启动MySQL命令：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># /etc/init.d/mysql.server start -user=mysql</div></div><div><font style="font-size: 14px;"><br/></font></div><ol start="12"><li><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">安装Hbase</span></font></div></li></ol><ul><li><div>规划在node2, node3, node4 节点中安装Hbase，其中node2作为主节点，node2, node3, node4作为从节点</div></li><li><div>在 node2 节点 /opt/ 解压 hbase 安装包，（在node2上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"># cd /opt/</span></div><div># tar -zxvf hbase-1.2.6-bin.tar.gz</div></div><ul><li><div>修改配置环境，（在node2上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>修改 hbase-env.sh </div><div># vi hbase-env.sh </div><div><br/></div><div>将 JAVA_HOME, HADOOP_HOME, HBASE_LOG_DIR, HBASE_MANAGES_ZK 修改为以下内容： 记得去掉前面的#</div><div> export JAVA_HOME=/usr/local/jdk1.8.0_201         # 配置 JDK 安装路径</div><div> export HADOOP_HOME=/opt/hadoop-2.6.5      # 配置 Hadoop 安装路径  </div><div> export HBASE_LOG_DIR=/home/hadoop_files/hbase/logs      # 设置 HBase 的日志目录</div><div> export HBASE_MANAGES_ZK=false        # 使用独立的 ZooKeeper 集群</div><div> export HBASE_PID_DIR=/home/hadoop_files/hbase        # 设置 pid 的路径</div><div><br/></div><div>配置 hbase-site.xml</div><div># vi hbase-site.xml</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">添加如下配置</span></div><div>&lt;property&gt;</div><div>    &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;</div><div>    &lt;value&gt;node2,node3,node4&lt;/value&gt;</div><div>    &lt;description&gt;zookeeper集群节点&lt;/description&gt;</div><div>&lt;/property&gt;</div><div>&lt;property&gt;</div><div>    &lt;name&gt;hbase.rootdir&lt;/name&gt;</div><div>    &lt;value&gt;hdfs://node1:8020/hbase&lt;/value&gt;    <i>&lt;value&gt;hdfs://mycluster/hbase&lt;/value&gt;若是HA的hadoop则需要修改为集群名称</i></div><div>    &lt;description&gt;hbase数据存放到HDFS中的路径&lt;/description&gt;</div><div>&lt;/property&gt;</div><div>&lt;property&gt;</div><div>    &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;</div><div>    &lt;value&gt;true&lt;/value&gt;</div><div>    &lt;description&gt;是否启动分布式</div><div>      false: standalone and pseudo-distributed setups with managed ZooKeeper</div><div>      true: fully-distributed with unmanaged ZooKeeper Quorum (see hbase-env.sh)</div><div>    &lt;/description&gt;</div><div>&lt;/property&gt;</div><div>&lt;property&gt;</div><div>    &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;</div><div>    &lt;value&gt;/home/hadoop/hadoop_files/zk&lt;/value&gt;</div><div>    &lt;description&gt;Property from ZooKeeper config zoo.cfg.指向zookeeper的存放数据路径&lt;/description&gt;</div><div>&lt;/property&gt;</div><div>&lt;property&gt;</div><div>    &lt;name&gt;hbase.tmp.dir&lt;/name&gt;</div><div>    &lt;value&gt;/home/hadoop/hadoop_files/hbase/tmp&lt;/value&gt;</div><div>    &lt;description&gt;存储临时数据路径&lt;/description&gt;</div><div>&lt;/property&gt;</div><div>&lt;property&gt;</div><div>     &lt;name&gt;zookeeper.session.timeout&lt;/name&gt;</div><div>     &lt;value&gt;120000&lt;/value&gt;</div><div>&lt;/property&gt;</div><div>&lt;property&gt;</div><div>    &lt;name&gt;hbase.master.info.port&lt;/name&gt;</div><div>    &lt;value&gt;16010&lt;/value&gt;</div><div>    &lt;description&gt;Hbase Master的web UI访问端口&lt;/description&gt;</div><div>&lt;/property&gt;</div><div>&lt;property&gt;</div><div>    &lt;name&gt;hbase.regionserver.info.port&lt;/name&gt;    </div><div>    &lt;value&gt;16030&lt;/value&gt;</div><div>    &lt;description&gt;Hbase regionServer的web UI访问端口&lt;/description&gt;</div><div>&lt;/property&gt;</div><div>&lt;property&gt;</div><div>    &lt;name&gt;hbase.zookeeper.property.clientPort&lt;/name&gt;</div><div>    &lt;value&gt;2181&lt;/value&gt;</div><div>&lt;/property&gt;</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div>// 配置 regionservers节点</div><div># vi regionservers </div><div>删除 localhost 添加如下内容： </div><div><font face="Monaco">node2</font></div><div><font face="Monaco">node3</font></div><div><font face="Monaco">node4</font></div><div><font face="Monaco"><br/></font></div><div>// 删除 hbase 的 slf4j-log4j12-1.7.5.jar，解决 hbase 和 hadoop 的 LSF4J 包冲突 </div><div># cd /opt/hbase-1.2.6/lib </div><div># mv slf4j-log4j12-1.7.5.jar slf4j-log4j12-1.7.5.jar.bk</div></div><ul><li><div>将 hbase 工作目录同步到集群其它节点，（在node2上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># scp -r /opt/hbase-1.2.6/ cluster3:/opt/ </div><div># scp -r /opt/hbase-1.2.6/ cluster4:/opt/</div></div><ul><li><div>创建hbase缓存、日志路径（所有节点）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># mkdir -p /home/hadoop_files/hbase/tmp</div><div># mkdir -p /home/hadoop_files/hbase/logs</div></div><ul><li><div>改权限（所有节点）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># chown -R hadoop:hadoop /opt/hbase-1.2.6</div><div># chown -R hadoop:hadoop /home/hadoop_files/hbase</div></div><ul><li><div>修改环境变量</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># vi /etc/profile </div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">添加如下内容</span></div><div>export HBASE_HOME=/usr/local/hbase-1.2.6 </div><div>export PATH=$HBASE_HOME/bin:$PATH </div><div><br/></div><div># source /etc/profile</div></div><ul><li><div>启动 HBase（主节点node2 上），需要切换到hadoop用户下</div></li></ul><div>注意：先启动 zookeeper，Hadoop 的 HDFS 和 YARN，然后才能启动 HBase</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ start-dfs.sh</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ start-yarn.sh</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ start-hbase.sh</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ stop-hbase.sh</span></div></div><ul><li><div>测试，可以访问web UI ，node2:16010</div></li></ul><div><br/></div><ol start="13"><li><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">安装Spark</span></font><br/></div></li></ol><ul><li><div>规划在node1, node3, node4节点上安装spark。</div></li><li><div>上传spark安装包到node1节点上，解压到 /opt/ 目录下，（在node1节点上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># cd /opt</div><div># tar -zxvf spark-1.6.3-bin-hadoop2.6.tgz</div><div># mv spark-1.6.3-bin-hadoop2.6.tgz spark-1.6.3        // 重命名为spark-1.6.3</div></div><ul><li><div>配置环境变量</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># vi /etc/profile </div><div>添加以下内容： </div><div> export SPARK_HOME=/usr/local/spark-1.6.3</div><div> export PATH=$SPARK_HOME/bin:$PATH</div><div><font style="color: rgb(255, 38, 0);">主节点要再加一行（node1）：</font> </div><div> export PATH=$SPARK_HOME/sbin:$PATH</div></div><ul><li><div>修改配置文件，（在node1上执行）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># cd /opt/spark-1.6.3</div><div><br/></div><div>复制 conf 文件夹里面 template 一份，改名为 spark-env.sh </div><div># cp conf/spark-env.sh.template conf/spark-env.sh</div><div><br/></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">在spark-env.sh文件中添加如下内容</span></div><div> export SPARK_MASTER_IP=node1            // 主节点的主机名</div><div> export SPARK_MASTER_PORT=7077           // 主节点的端口</div><div> export SPARK_WORKER_CORES=2</div><div> export SPARK_MASTER_WEBUI_PORT=8888        // 主节点web ui的端口,默认是8080</div><div> export SPARK_WORKER_MEMORY=1g           // 运行内存</div><div> export HADOOP_CONF_DIR=/opt/hadoop-2.6.5/etc/hadoop        // hadoop的配置文件所在目录的路径</div><div> export SPARK_PID_DIR=/home/hadoop/hadoop_files/spark        // spark存储数据的目录路径，可以填自己的</div><div> export JAVA_HOME=/usr/local/jdk1.8.0_201                // jdk安装路径，根据自己实际的填写</div><div><br/></div><div># vi conf/slaves         // 从节点的主机名</div><div>添加以下几行 </div><div> node3</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"> n</span><font face="Monaco">ode4</font></div></div><ul><li><div>分发到从节点上（这里是node3, node4），在node1上执行</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>// 复制到所有的服务器上 </div><div># scp -r /opt/spark-1.6.3 node3:/opt/</div><div># scp -r /opt/spark-1.6.3 node4:/opt/</div></div><ul><li><div>修改 spark 文件夹的权限（每个 spark 结点）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div># chown -R hadoop:hadoop /opt/spark-1.6.3</div></div><ul><li><div>运行spark集群，（在主节点node1上执行）</div></li></ul><div>        注意：</div><ul><ul><li><div>spark应用中 sbin/start-all.sh 命令是和Hadoop中start-all.sh 命令重名，并且路径都在PATH中，谁在前，启动谁。所以，需要修改spark的运行命令名为start-spark.sh。同样stop-all.sh也需如此。</div></li><li><div>若不将 spark的 sbin/ 路径加入到PATH中，则不需要上一步，但是每次启动需要进入 /opt/spark-1.6.3/sbin 目录下启动命令 start-all.sh 。</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>运行 spark 前需启动 hadoop 的 HDFS 和 YARN</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">在主节点中，启动全部spark集群。</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ start-spark.sh</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">关闭</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ stop-spark.sh</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">分别启动spark集群中主，从节点</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ start-master.sh</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">$ start-slaves.sh</span></div></div><ul><li><div>测试可以查看进程，访问web界面更 node1:8888</div></li></ul><div><br/></div></body></html>
            </article>
        </div>
      </div>
    </div>
  </div>
</div>

    
    <footer class="footer" role="contentinfo">
	<div class="container">
		<center>
		<p class="copyright">Copyright &copy; 2019-2019 <a href="https://github.com/huism"><code>huism</code></a>.</p>
		<p>Powered by <a href="http://jekyllrb.com">jekyll</a>, themed from <a href="http://lesscss.cn/">Less</a> . <!-- refactored by <a href="http://www.hifreud.com/">huism</a> --></p>
		</center>
	</div>
</footer>

<script src="/styles/js/jquery.min.js"></script>
<script src="/styles/js/bootstrap.min.js"></script>
<script src="/styles/js/holder.min.js"></script>
<script src="/styles/js/lessismore.js"></script>
<script src="/styles/js/application.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  </body>
</html>
